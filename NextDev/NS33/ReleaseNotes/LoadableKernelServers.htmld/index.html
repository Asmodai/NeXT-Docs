<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<!-- Created with LatinByrd III -->
<!-- File: /NextLibrary/Documentation/NextDev/ReleaseNotes/LoadableKernelServers.rtf -->
<!-- Date: Sun Jan  1 17:04:58 2023 -->
<head>
<title>LoadableKernelServers</title>
</head>

<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" alink="#FF00FF" vlink="#FF0000">

<basefont size=3>

<p><font face="Times">Release 3.3 Copyright</font> &copy;<font face="Times">1995 by NeXT Computer, Inc.&nbsp; All Rights Reserved.</font>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+3">3.3 Release Notes:</font><br>
<font face="Times" size="+3">Writing Loadable Kernel Servers</font>

<p><br><br><br>

<p><font face="Times" size="+1">This file contains release notes for the 3.3, 3.2, 3.1, and 3.0 releases of loadable kernel servers.&nbsp; Items specific to the 3.1 release are listed first, and the Release 3.0 notes follow. There are no items specific to the 3.3 or 3.2 releases.</font></td></tr>

</table>

<p><br><br><br>

<p><font face="Times" size="+2"><b>Notes Specific to Release 3.1</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times" size="+1"><b>New Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">The following new features have been added to the kernel-server loader since Release 3.0:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">Support for object-oriented loadable kernel servers written in Objective C.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">Support for fat Mach-O files for loadable kernel servers.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">See the Driver Kit release notes for more information.</font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+2"><b>Notes Specific to Release 3.0</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">In Release 3.0, the following changes were made:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">Changes to the flags required when compiling loadable kernel servers</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">New kernel support functions</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">Changes to the kernel-server loader and its header files</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">For more about these and related topics, see Part 2, &#34;Writing Loadable Kernel Servers,&#34; of the <i>NEXTSTEP Operating System Software</i> manual.</font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+2"><b>C Preprocessor Flags</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times" size="+1"><b>Incompatible Changes</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">The KERNEL_FEATURES flag must be replaced by the new flag, MACH_USER_API. To compile a loadable kernel server, you must define MACH_USER_API, KERNEL, and MACH, as shown in Chapter 9, &#34;Building, Loading, and Debugging Loadable Kernel Servers,&#34; of the <i>NEXTSTEP Operating System Software</i> manual.&nbsp; Flags such as these are typically defined either in the <b>cc</b> command line (e.g., &#34;-DKERNEL&#34;) or inside of source code (e.g., &#34;#define KERNEL 1&#34;).</font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+2"><b>Kernel Support Functions</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times" size="+1"><b>New Functions</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">The following are new functions that have been added to the kernel since Release 2.0.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=71></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">Functions for getting and setting clock information: <b>clock_value()</b>, <b>set_clock()</b>, <b>clock_attributes()</b>.&nbsp; New functions for converting between clock formats have also been added:&nbsp; <b>ns_time_to_timeval()</b> and <b>timeval_to_ns_time().</b>&nbsp; (<b>microboot()</b> and <b>microtime()</b> are obsolete.)</font></td></tr>

<tr valign=top>

<td width=71 height=17></td></tr>

<tr valign=top>

<td width=71></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">Functions for setting and canceling timeouts:&nbsp; <b>ns_abstimeout()</b>, <b>ns_timeout()</b>, <b>ns_untimeout()</b>.&nbsp; These functions replace <b>us_abstimeout()</b>, <b>us_timeout()</b>, and <b>us_untimeout()</b>, which are obsolete.</font></td></tr>

<tr valign=top>

<td width=71 height=17></td></tr>

<tr valign=top>

<td width=71></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">A function for getting the task port of the kernel:&nbsp; <b>kern_serv_kernel_task_port()</b>. This function makes it easier for loadable kernel servers to send and receive Mach messages that have out-of-line data.</font></td></tr>

<tr valign=top>

<td width=71 height=17></td></tr>

<tr valign=top>

<td width=71></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">Functions to help UNIX-style drivers implement the <b>select()</b> system call: <b>selthreadcache()</b> and <b>selthreadclear()</b>.</font></td></tr>

<tr valign=top>

<td width=71 height=17></td></tr>

<tr valign=top>

<td width=71></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">Functions to help network modules get information about other network modules: <b>if_class()</b>, <b>iflist_first()</b>, <b>iflist_next()</b>.</font></td></tr>

<tr valign=top>

<td width=71 height=17></td></tr>

<tr valign=top>

<td width=71></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">A function that removes a netif from the system list of netifs:&nbsp; <b>if_detach()</b>.</font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+2"><b>Kernel-Server Loader</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times" size="+1"><b>New Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">The following are new features that have been added to the kernel-server loader since Release 2.0.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=71></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">A DETACH keyword has been added to Load Command processing.&nbsp; If this command is used then the kernel-server loader will not attempt to unload the server when it shut down.&nbsp; This is necessary for the correctness of some network protocols.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times" size="+1"><b>Changes</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">The following compatible changes have been made to the kernel-server loader since Release 2.0.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=71></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">Header files are now exported into <b>/NextDeveloper/Headers/kernserv</b>.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times" size="+1"><b>Incompatible Changes</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=71></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">The <b>kern_loader_reply_handler.h</b> header file is now generated by MiG.&nbsp; As a result, the KERN_LOADER_REPLY_INMSG_SIZE and KERN_LOADER_REPLY_OUTMSG_SIZE macros have been replaced with kern_loader_replyMaxRequestSize and kern_loader_replyMaxReplySize, respectively.</font></td></tr>

</table>



</body>
</html>
