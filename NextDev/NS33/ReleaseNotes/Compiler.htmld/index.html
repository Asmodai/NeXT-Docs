<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<!-- Created with LatinByrd III -->
<!-- File: /NextLibrary/Documentation/NextDev/ReleaseNotes/Compiler.rtf -->
<!-- Date: Sun Jan  1 17:04:55 2023 -->
<head>
<title>Compiler</title>
</head>

<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" alink="#FF00FF" vlink="#FF0000">

<basefont size=3>

<p><font face="Times">Release 3.3 Copyright</font> &copy;<font face="Times">1995 by NeXT Computer, Inc.&nbsp; All Rights Reserved.</font>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+3">3.3 Release Notes:</font><br>
<font face="Times" size="+3">C Compiler</font>

<p><br><br><br>

<p><font face="Times" size="+1">This file contains release notes for for the 3.3, 3.2, 3.1, and 3.0 releases of the GNU C Compiler.&nbsp; Items specific to the 3.3 release are listed first, and the Release 3.2, 3.1 and 3.0 notes follow.</font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+2"><b>Notes Specific to Release 3.3</b></font>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times" size="+1">In this release, the compiler is based on the GNU C compiler version 2.5.8.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times" size="+1"><b>Recompilation Requirements</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times" size="+1">You need to recompile existing code under certain circumstances:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>C++ name mangling change.</b> The method of &quot;mangling&quot; C++ function names has been changed. You must recompile all C++ programs when you start using NEXTSTEP's 3.3. <b>libg++</b> is updated to use the new mangling scheme.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times" size="+1"><b>New Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times" size="+1">The following features--categorized by language--have been added to the compiler for NEXTSTEP Release 3.3:</font>

<p><br><br><br>

<p><font face="Times" size="+1"><b>C Language Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>Better type checking</b>. The compiler's ability to do static type checking has been considerably improved. However, some programs that previously compiled may now fail to compile correctly because the compiler catches type errors it previously ignored.</font></td></tr>

<tr valign=top>

<td width=105 height=12></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>Volatile and const declarations must match definitions.</b> The C compiler used to allow a declaration and its definition to mismatch with respect to <b>volatile</b> and <b>const</b> storage class specifiers. The compiler now issues an error for a declaration/definition mismatch--for both variables and functions. This example shows the problem for a variable:</font></td></tr>

</table>  <font face="Courier">// First file</font>  extern int time_counter;  // declaration  ...  // End of file  // Second file  volatile int time_counter;// definition: adds volatile specifier--<font face="Courier"><b>Error</b></font>  <font face="Courier">...</font>  // End of file

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>Implicit cast from int to enums.</b> The compiler used to allow implicit casts from <b>int</b> to any <b>enum</b> type. According to both the ANSI C and C++ standards, this isn't correct behavior, so a warning is issued for such casts. Casting is a problem in this case because the integer value may not lie in the range of the <b>enum</b> type. The following example illustrates the difficulty:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier">int counter = 12;</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier">enum colors{</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier">red, orange, yellow, green = 20, blue, indigo, violet} aColor;</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier">aColor = counter;  // <b>Warning</b>:&nbsp; casts int to enum</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times" size="+1">Since red == 0, orange == 1, yellow == 2, green == 20, and so on, an <b>enum</b> of type colors can't take on the value 12. No valid conversion is possible.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>Enum arithmetic.</b> The compiler used to allow increment and decrement operations on <b>enum</b>s. This is forbidden in the ANSI C++ standard, so a warning is issued. The problem is that the resulting integer value may not lie in the range of the <b>enum</b> type. For instance, consider the <b>aColor enum</b> of the previous example:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier">aColor = yellow;  // aColor = 2</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier">aColor++;  // <b>Warning</b>:&nbsp; aColor = 3?</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times" size="+1">If <b>aColor</b> == 3, then it's out of range of the <b>enum</b> colors type since yellow == 2 and green == 20.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>Assignment used as a conditional.</b> When the <b>-Wall</b> option is turned on, the compiler issues a warning for assignments used as conditionals in <b>if</b>, <b>for</b>, and <b>while</b> statements. For example, the code</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier">if (i = generate()) { ... }</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times" size="+1">generates a warning, suggesting an extra set of parenthesis around the assignment</font><br>
<font face="Times" size="+1">such as</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier">if ((i = generate())) { ... }</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times" size="+1">This warning is intended to catch situations where you really meant to test for equivalence ==, not perform an assignment =. The <b>-Wno-parentheses</b> flag turns off</font><br>
<font face="Times" size="+1">this warning.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>Array and structure initializers.</b> An initializer's C syntax for assigning a value to a structure field is now &quot;<i>.field_name=</i>&quot;. The corresponding syntax for array initializers is now &quot;<i>[index]=</i>&quot;. Some examples of this usage follow:</font></td></tr>

</table>  <font face="Courier">NXRect point = {.origin={0,0}, .size={2,3}};</font>  char whitespace[256] = { [' ']=1, ['\t']=1, ['\n']=1 };

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times" size="+1">This was changed to agree with the syntax proposed by the Numerical C Extensions Group (NCEG). Although NeXT's C++ doesn't support these kinds of initializers, the C compiler handles them properly.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>-fkeep-inline-functions option.</b> Previous versions of the compiler eliminated unused static inline functions. This flag forces them to be compiled into the image.</font></td></tr>

<tr valign=top>

<td width=105 height=12></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>-Wno-format.</b> This warning option used to be called <b>-Wnoformat</b> (without the dash), but has been renamed to be consistent with the rest of the compiler flags. Both forms are accepted, but the newer syntax is recommended.</font></td></tr>

<tr valign=top>

<td width=105 height=12></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>Nested functions.</b> Pascal-style nested functions are now supported in C. If you use this feature, the resulting code will be incompatible with pre-3.3 systems. See the <b>gcc</b> manual for more information.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times" size="+1"><b>Objective C Language Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>Accessing instance variables in class methods.</b> It used to be common programming style in Objective C to assign to <b>self</b> in a class method and then access instance variables. This is bad style because <b>self</b> in the context of a class method stands for the class object--and shouldn't be redefined to stand for a particular <i>instance</i> of the object.</font></td></tr>

<tr valign=top>

<td width=105 height=12></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap></td>

<td><font face="Times" size="+1">Here is an example of this <i>bad</i> style:</font></td></tr>

</table>  <font face="Courier">@implementation Oval : Object</font>  { &nbsp;&nbsp;&nbsp;&nbsp; int x;  }  +new { &nbsp;&nbsp;&nbsp;&nbsp; self = [super new];  // Now <font face="Courier"><b>self</b> refers to a class instance</font> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ... &nbsp;&nbsp;&nbsp;&nbsp; x = 4;  // Assigns an instance variable  } ...  @end  ...  x = [Oval new];  // Create an Oval object

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times" size="+1">To discourage this anachronistic use, the compiler issues a warning if an instance variable is referenced in a class method.</font>

<p><font face="Times" size="+1">Here is a better way to instantiate an object:</font></td></tr>

</table>  <font face="Courier">x = [[Oval alloc] init];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times" size="+1">See <i>Object-Oriented Programming and the Objective C Language</i> for more details.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>Stricter Objective C syntax checking.</b> The compiler's syntax checking is now stricter, so you aren't allowed to nest <b>@interface</b> and <b>@implementation </b>blocks.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times" size="+1"><b>C++ Language Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>C++ support.</b> The compiler now supports ANSI C++.</font></td></tr>

<tr valign=top>

<td width=105 height=12></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>libg++ support.</b> The GNU C++ library, <b>libg++</b>, provides a variety of C++ programming tools and other support to C++ programmers. <b>libg++</b> is similar to some extent to AT&amp;T's <b>libC.a</b>. The library and full documentation is in <b>/NextLibrary/Documentation/GNU-libg++</b>. Also see the Release Note <b>libg++.rtf</b>.</font></td></tr>

<tr valign=top>

<td width=105 height=12></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>Objective C messages to converted C++ objects (&quot;smart pointers&quot;).</b> You can now send an Objective C message to a C++ object that has been converted by a conversion operator. In the following example, the C++ ptrSquare object <b>aSquare</b> is implicitly converted to the Objective C type Square* using the conversion <b>operator Square*()</b>. The converted object receives the message <b>calculateArea</b>:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier">@interface Square { id a; } ...</font>  @end  class ptrSquare { &nbsp;&nbsp;&nbsp;&nbsp; Square* value;  public: &nbsp;&nbsp;&nbsp;&nbsp; operator Square*();  };  square (ptrSquare aSquare) { &nbsp;&nbsp;&nbsp;&nbsp; float z = [aSquare calculateArea]; // invokes operator Square*()<br>
<img src="../../Images/sp.gif" width=164 height=1><font face="Courier">}</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times" size="+1">Due to the conversion, the compiler acts as if <b>aSquare</b> is statically typed to Square* in the message expression.</font>

<p><font face="Times" size="+1">The above example uses only one conversion operator: <b>operator Square*</b>. You should avoid having multiple conversion operators in the same class that produce different pointer types--the compiler may choose the wrong conversion operator and not produce the desired type. If you need more than one conversion type, you must use an <b>operator id</b> conversion operator--the compiler chooses this over an operator converting to any other Objective C class pointer type. If the class ptrSquare implemented other <b>operator X*()</b> conversions besides <b>operator Square*()</b>, it would also have to implement an <b>operator id</b> conversion so the compiler would know which conversion to look for.</font>

<p><font face="Times" size="+1">Conversion operators allow you to implement so called &quot;smart pointers&quot; to Objective C objects. Smart pointers are objects that act like pointers and perform some other action in addition whenever an object is accessed through them. For more information on smart pointers, see Bjarne Stroustrup's <i>The C++ Programming Language, Second Edition</i> (Addison-Wesley, 1991).</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>C++ multiple virtual inheritance.</b> The C++ compiler now invokes virtual functions correctly--except when a non-virtual function is redeclared as virtual in a subclass. The compiler issues a warning in this case, however.</font></td></tr>

<tr valign=top>

<td width=105 height=12></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap></td>

<td><font face="Times" size="+1">In this example, the function <b>f()</b> in class Animal is redeclared <b>virtual</b> in the subclass Mammal:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier">class Animal  { void f(); }</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier">class Mammal : public virtual Animal  { virtual void f(); }</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier">class Quadruped : public virtual Animal  { virtual void f(); }</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier">class Dog : public Mammal, public Quadruped  { virtual void f(); }</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier">class Terrier : public Dog  { virtual void f(); }</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times" size="+1">Invoking the method <b>f()</b> gives the wrong result in the following case:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier">void zoo(void) {</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier">Terrier* terrier = new Terrier;</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier">Mammal* mammal = terrier;</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier">Quadruped* quadruped = terrier;</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier">Dog* dog = terrier;</font>

<p><img src="../../Images/sp.gif" width=152 height=1><font face="Courier">quadruped-&gt;f();  // <b>Wrong</b> - invokes Dog::f()</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier">mammal-&gt;f();  // Right - invokes Terrier::f()</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier">dog-&gt;f();  // Right - invokes Terrier::f()</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier">}</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times" size="+1">The compiler now warns that wrong code may be generated:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier">warning: method `Animal::f()' redeclared as `virtual Mammal::f()'</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times" size="+1">If you modify the above hierarchy by making the function <b>f()</b> in Animal virtual, the invocation works correctly. The workaround is therefore to make <b>f()</b> virtual throughout the hierarchy:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier">class Animal  { <b>virtual</b> void f(); }</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier">class Mammal : public virtual Animal  { virtual void f(); }</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier">class Quadruped : public virtual Animal  { virtual void f(); }</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier">class Dog : public Mammal, public Quadruped  { virtual void f(); }</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier">class Terrier : public Dog  { virtual void f(); }</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>Pointers to member functions.</b> The C++ compiler used to allow using member function pointers with objects that might not recognize the pointer or its contents. The compiler now flags these as errors. Here's an example of such errors:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier">class Mammal { public: void f(int); };</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier">class Cat : public Mammal { public: void f(int); };</font>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier">void g (Cat* aCat, Mammal* aMammal) {</font><br>
<img src="../../Images/sp.gif" width=157 height=1><font face="Courier">void (Mammal::*mammal_f_ptr)(int) = &amp;Mammal::f;</font><br>
<img src="../../Images/sp.gif" width=157 height=1><font face="Courier">void (Cat::*cat_f_ptr)(int) = &amp;Cat::f;</font>

<p><img src="../../Images/sp.gif" width=150 height=1><font face="Courier">(aCat-&gt;*mammal_f_ptr)(4);  // OK</font><br>
<img src="../../Images/sp.gif" width=150 height=1><font face="Courier">(aMammal-&gt;*cat_f_ptr)(5);  // <b>Error</b> (1)</font><br>
<img src="../../Images/sp.gif" width=150 height=1><font face="Courier">cat_f_ptr = &amp;Cat::f;  // OK</font><br>
<img src="../../Images/sp.gif" width=150 height=1><font face="Courier">mammal_f_ptr = &amp;Cat::f;  // <b>Error</b> (2)</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier">}</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times" size="+1">The local variables <b>mammal_f_ptr</b> and <b>cat_f_ptr</b> are pointers to member functions, and the function g initializes them to point to the class Cat member function, <b>f</b>. It then attempts to invoke this function through these pointers. Statement (1) is an error because you can't be sure than a Mammal object, <b>aMammal</b>, &quot;responds to&quot; a Cat member pointer, <b>cat_f_ptr</b>--especially since <b>cat_f_ptr</b> points to a Cat member function that Mammal would know nothing about. Even if <b>cat_f_ptr</b> were initialized to a Mammal member function, <b>cat_f_ptr</b> cannot safely be applied to a Mammal object. The assignment in (2) is an error because you cannot be sure that some member function</font><br>
<font face="Times" size="+1">of a derived class (in this case Cat::<b>f</b>) is available in any of its base classes (in this</font><br>
<font face="Times" size="+1">case Mammal).</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>Implicit cast from void* to C++ object pointer.</b> The C++ compiler used to implicitly allow casts from <b>void*</b> to any C++ object pointer type. This isn't allowed in the ANSI C++ standard, so a warning is issued when such a cast is detected. If aClass is some arbitrary class, the following cast produces a warning:</font></td></tr>

</table>  <font face="Courier">void *vp1;</font>  aClass *obj1, *obj2;  vp1 = &amp;obj1;  obj2 = vp1;  // <font face="Courier"><b>Warning</b>:&nbsp; casts void pointer</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>#pragma cplusplus.</b> This new pragma is used to resolve the problem of having C++ system header files.&nbsp;&nbsp; All system header files are by default included in implicit <b>extern &#34;C&#34;</b>.&nbsp;&nbsp; When <b>#pragma cplusplus</b> appears in a header file, the rest of that file is embedded in an implicit <b>extern &#34;C++&#34;</b> block. Alternatively, if either <b>g++</b> or <b>c++</b> appears in the full path name to a header file (ignoring case), it is also considered to be C++.</font><br>
<font face="Times" size="+1">An error is reported if this pragma appears inside an explicit <b>extern &#34;C&#34; {...}</b>.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=5></td>

<td><font face="Times" size="+1"><b>Known Problems</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">These problems exist in version 2.5.8 of the compiler:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Reference:</font></td>

<td><font face="Times" size="+1">39034, 45027</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Problem:</font></td>

<td><font face="Times" size="+1">A <b>static</b> pointer to an Objective C subclass can't be passed to a C++ member function.</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Description:</font></td>

<td><font face="Times" size="+1">C++ has no knowledge of the Objective C class hierarchy. C++ code containing <b>static</b> references to sub-classed Objective C objects will not compile.</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Workaround:</font></td>

<td><font face="Times" size="+1">Remove the <b>static</b> qualifier.</font></td></tr>

<tr valign=top>

<td width=90 height=29></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Reference:</font></td>

<td><font face="Times" size="+1">40546</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Problem:</font></td>

<td><font face="Times" size="+1">Complex number support is unreliable.</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Description:</font></td>

<td><font face="Times" size="+1">The complex number handling part of the compiler is untested and has been found to be erroneous in some cases. It is not recommended that this feature be used.</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Workaround:</font></td>

<td><font face="Times" size="+1">Define your own complex number class with the methods you need.</font></td></tr>

<tr valign=top>

<td width=90 height=29></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Reference:</font></td>

<td><font face="Times" size="+1">41950</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Problem:</font></td>

<td><font face="Times" size="+1">Immediate long doubles don't work sometimes.</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Description:</font></td>

<td><font face="Times" size="+1">Using a form such as 23450.0L to write an immediate long double value may cause the compiler to report an internal error.</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Workaround:</font></td>

<td><font face="Times" size="+1">None.</font></td></tr>

<tr valign=top>

<td width=90 height=29></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Reference:</font></td>

<td><font face="Times" size="+1">42975</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Problem:</font></td>

<td><font face="Times" size="+1">Bitfields may not work properly with <b>-O2</b> optimization.</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Description:</font></td>

<td><font face="Times" size="+1">If you use <b>-O2</b> optimization, the compiler may return a wrong value in a bitfield.</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Workaround:</font></td>

<td><font face="Times" size="+1">Don't use <b>-O2</b> optimization.</font></td></tr>

<tr valign=top>

<td width=90 height=29></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Reference:</font></td>

<td><font face="Times" size="+1">44109</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Problem:</font></td>

<td><font face="Times" size="+1">Programs with detectable NaN to <b>int</b> conversion won't compile with optimization on PA-RISC systems.</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Description:</font></td>

<td><font face="Times" size="+1">If you attempt to compile a program with a conversion on a non-number to an <b>int</b> with <b>-O</b> optimization, the compile fails. In other compiler versions, the compiler emits a warning about the Nan to <b>int </b>conversion.</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-1">Workaround:</font></td>

<td><font face="Times" size="+1">Don't use <b>-O</b> optimization.</font></td></tr>

</table>

<p><br><br><br>

<p><font face="Times" size="+2"><b>Notes Specific to Release 3.2</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times" size="+1"><b>New Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">The following new features have been added to the GNU C Compiler for Release 3.2.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>Support for RTF&nbsp; source code.</b>&nbsp; Rich Text Format files can now be compiled.&nbsp; The preprocessor strips out all RTF directives, leaving only ASCII text for the compiler itself.&nbsp; See the <b>Preprocessor.rtf</b> release note for more information.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1"><b>Automatic searching for C++ headers.</b>&nbsp; When compiling a C++ file (extension <b>.C</b>, <b>.M</b>, or <b>.cc</b>), the compiler adds <b>/NextDeveloper/Headers/g++</b> to its header search path.&nbsp; This allows <b>libg++</b> classes to be used without having to specify additional command-line options.</font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+2"><b>Notes Specific to Release 3.1</b></font>

<p><font face="Times" size="+2"><b>GNU C Compiler</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">The Release 3.1 Objective C compiler (as well as the Objective C++ compiler) is based on version 2.2.2 of the GNU Compiler (the Release 3.0 compiler was based on version 1.93).&nbsp; NeXT's implementation of Objective C has been integrated into the version 2.2.2 GNU sources.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times" size="+1"><b>New Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">The following new features have been added to the GNU C Compiler since Release 3.0.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">You can specify the target architecture you are compiling for with <b>-arch</b> <i>arch_type</i>. The full list of values for <i>arch_type</i> can be found in&nbsp; <b>arch</b>(3), but for now, you should only use the values <b>m68k</b> and <b>i386</b> (i386 is the processor family of the i486 processor). The option <b>-arch</b> <i>arch_type</i> specifies the target architecture, <i>arch_type</i>, of the operations to be performed.&nbsp; The operations affected by <b>-arch</b> are: preprocessing, precompiling, compiling, assembling, and linking.&nbsp; The specification of multiple architectures results in the production of ``fat'' output files and the creation of multiple ``thin'' intermediate files from each stage.&nbsp; It is an error to use <b>-E</b>, <b>-S</b>, <b>-M</b>, and <b>-MM </b>with multiple architectures as the output form is textual in these cases.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">The implied meaning of file name suffixes has been extended.&nbsp; The following suffixes are now recognized:</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap></td>

<td><img src="../../Images/sp.gif" width=3 height=1><font face="Times" size="+1"><i>file</i>.<b>c</b> contains C source code.</font><br>
<img src="../../Images/sp.gif" width=3 height=1><font face="Times" size="+1"><i>file</i>.<b>m</b> contains Objective C source code.</font><br>
<img src="../../Images/sp.gif" width=3 height=1><font face="Times" size="+1"><i>file</i>.<b>C</b> and <i>file</i>.<b>cc</b> contains C++ source code.</font><br>
<img src="../../Images/sp.gif" width=3 height=1><font face="Times" size="+1"><i>file</i>.<b>M</b> contains mixed Objective C and C++ source code.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">Optimizations performed by the compiler are more robust.&nbsp; The <b>-fstrength-reduce </b>optimization is now beneficial and is enabled by <b>-O</b>.&nbsp; The <b>-fcombine-regs</b> optimization is selected as part of <b>-O</b>, and has been dropped as an option.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">Several new optimizations have been added, primarily to support the i386 architecture. Most of these new optimizations are enabled by the <b>-O3</b> and <b>-O4</b> switches and are only implemented in the i386 compiler.&nbsp; Each optimization may be individually turned on or off by using the flag <b>-f</b><i>opt</i> or <b>-fno-</b><i>opt</i>.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Times" size="+1"><b>Optimization</b></font></td>

<td nowrap><font face="Times" size="+1"><b>Enabled by</b></font></td>

<td><font face="Times" size="+1"><b>Description</b></font></td></tr>

<tr valign=top>

<td width=90 height=10></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Times" size="+1"><b>-fcse-skip-blocks</b></font></td>

<td nowrap><font face="Times" size="+1"><b>-O2</b></font></td>

<td><font face="Times" size="+1">Similar to <b>-fcse-follow-jumps</b>, but causes CSE to follow jumps which conditionally skip over blocks. When CSE encounters a simple <b>if</b> statement with no <b>else</b> clause, this option causes CSE to follow the jump around the body of the <b>if</b>.&nbsp; <i>This switch isn't specific to the i386 architecture.</i></font></td></tr>

<tr valign=top>

<td width=90 height=17></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Times" size="+1"><b>-fcompare-elim</b></font></td>

<td nowrap><font face="Times" size="+1"><b>-O3</b></font></td>

<td><font face="Times" size="+1">Attempt to remove the compare at the end of a loop by having the loop counter count up to zero.&nbsp; This results in a more efficient conditional jump at the end of the loop.</font></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Times" size="+1"><b>-fcomplex-givs</b></font></td>

<td nowrap><font face="Times" size="+1"><b>-O3</b></font></td>

<td><font face="Times" size="+1">Enable strength reduction of generalized induction variables that require more than one instruction for initialization.</font></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Times" size="+1"><b>-fcopy-prop</b></font></td>

<td nowrap><font face="Times" size="+1"><b>-O3</b></font></td>

<td><font face="Times" size="+1">Strength reduction and loop unrolling may copy one register to another before the loop and use the copy within the loop.&nbsp; Here, an attempt is made to use the original in the loop and eliminate the copy.</font></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Times" size="+1"><b>-fexpose-invars</b></font></td>

<td nowrap><font face="Times" size="+1"><b>-O3</b></font></td>

<td><font face="Times" size="+1">Enable rewriting of expressions in a loop with invariant subexpressions so as to combine and create more invariant subexpressions.</font></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Times" size="+1"><b>-fjump-back</b></font></td>

<td nowrap><font face="Times" size="+1"><b>-O3</b></font></td>

<td><font face="Times" size="+1">Attempt to perform strength reduction in outer loops as well as inner loops.</font></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Times" size="+1"><b>-fspl</b></font></td>

<td nowrap><font face="Times" size="+1"><b>-O3</b></font></td>

<td><font face="Times" size="+1">Attempt to rotate a loop that terminates with a floating point store so the store is at the top of the rotated loop.</font></td></tr>

<tr valign=top>

<td width=90 height=17></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Times" size="+1"><b>-fschedule-insns</b></font></td>

<td nowrap><font face="Times" size="+1"><b>-O4</b></font></td>

<td><font face="Times" size="+1">As described in <i>NEXTSTEP Development Tools and Techniques</i>.&nbsp; <i>This switch isn't specific to the i386 architecture.</i></font></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Times" size="+1"><b>-fschedule-insns2</b></font></td>

<td nowrap><font face="Times" size="+1"><b>-O4</b></font></td>

<td><font face="Times" size="+1">As described in <i>NEXTSTEP Development Tools and Techniques</i>.&nbsp; <i>This switch isn't specific to the i386 architecture.</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=90></td>

<td><font face="Times" size="+1">The <b>-fcaller-saves</b> optimization generally makes code worse on the i486, so it is not enabled by default at any optimization level when you use <b>-arch i386</b>.&nbsp; The new optimizations are subject to change.&nbsp; It is likely that these will be combined into a smaller set of options.&nbsp; These will also be made machine-independent and will eventually be implemented for all target architectures.</font>

<p><font face="Times" size="+1">There are some inconsistencies in the current mapping of optimization levels between <b>-arch i386</b> and <b>-arch m68k</b>.&nbsp; We expect to correct these in a future release.&nbsp; These are as follows:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">When you choose <b>-arch i386</b>, <b>-O</b> is taken to mean <b>-O2</b> instead of <b>-O1</b>.</font></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">The option <b>-O3</b> includes <b>-fomit-frame-pointer</b>, which makes debugging impossible. In the future, you will need to explicitly choose <b>-fomit-frame-pointer</b>, but for now, you should use <b>-fno-omit-frame-pointer</b> when you use <b>-O3</b>.</font></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">The options <b>-O3 -fno-omit-frame-pointer -fschedule-insns2</b> generally produce the best code.&nbsp; To simplify the interface, <b>-O4</b> will be eliminated as a distinct option and <b>-fschedule-insns2</b> will be added to <b>-O3</b>.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">The compiler now has additional predefined macros that can be used to determine the release version of the compiler.&nbsp; <i>Every effort should be made to minimize the use of these macros.</i>&nbsp; For each release of the compiler there will be a macro defined such as </font><font face="Courier">NX_COMPILER_RELEASE_3_0</font> <font face="Times" size="+1">and</font> <font face="Courier">NX_COMPILER_RELEASE_3_1</font><font face="Times" size="+1">.&nbsp; There will also be a macro</font> <font face="Courier">NX_CURRENT_COMPILER_RELEASE</font><font face="Times" size="+1">.&nbsp; One can conditionally compile code by numerically comparing these macros.&nbsp; For example:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=90 height=1><font face="Courier">#if NX_CURRENT_COMPILER_RELEASE &gt; NX_COMPILER_RELEASE_3_0</font>

<p><img src="../../Images/sp.gif" width=90 height=1><font face="Courier">#endif</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=90></td>

<td><font face="Times" size="+1">Note that if one wants to use these macros in code to be compiled with any compiler before release 3.1 they must additionally check whether the macro is defined, as in:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=90 height=1><font face="Courier">#if defined(NX_CURRENT_COMPILER_RELEASE) &amp;&amp; \</font><br>
<img src="../../Images/sp.gif" width=121 height=1><font face="Courier">NX_CURRENT_COMPILER_RELEASE &gt; NX_COMPILER_RELEASE_3_0</font>

<p><img src="../../Images/sp.gif" width=90 height=1><font face="Courier">#endif</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">The compiler detects and generates a warning for duplicate interface declarations.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">The compiler has been changed in the way it determines whether a class implements a protocol.&nbsp; In order for a class to implement a protocol, P, it must (1) implement all of the methods in P and (2) either (a) implement all the methods in any protocols adopted by P or (b) have a superclass which adopts the protocols adopted by P.</font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+2"><b>Notes Specific to Release 3.0</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">These notes were included with the Release 3.0 version of the GNU C Compiler. Sections that are no longer relevant have been marked with an italicized comment.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=71></td>

<td><font face="Times" size="+1">For more about these and related topics, see the following chapters in <i>NEXTSTEP Development Tool</i>s <i>and Techniques</i>:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">Chapter 1:&nbsp; &quot;Putting Together a NeXT Application&quot;</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">Chapter 6:&nbsp; &quot;The GNU C Compiler&quot;</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">Chapter 7:&nbsp; &quot;The GNU C Preprocessor&quot;</font></td></tr>

</table>

<p><br><br><br>

<p><font face="Times" size="+2"><b>GNU C Compiler</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">The Release 3.0 Objective C compiler is based on version 1.93 of the GNU Compiler (the Release 2.0 compiler was based on version 1.36).&nbsp; NeXT's implementation of Objective C has been integrated into the version 2.0 GNU sources.&nbsp; Significant improvements have been made to certain compiler optimizations, including the addition of a loop unrolling facility.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times" size="+1"><b>Incompatible Changes</b></font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1"><b>Incompatible Storage Class Specifier Bug Fix</b></font>

<p><font face="Times" size="+1">A compiler bug relating to incompatible storage class specifiers has been fixed which may cause source incompatibilities.&nbsp; ANSI C specifies that a function which is forward-declared to be <b>static</b> should not be globally visible, even if the definition of the function does not contain the <b>static</b> keyword.&nbsp; The Release-2.0 compiler incorrectly gave precedence to the definition of the function over the its forward-declaration and made the symbol global.&nbsp; For example, the program:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">static int foo (int x);</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">int foo (int x)</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">{</font><br>
<img src="../../Images/sp.gif" width=136 height=1><font face="Courier">return x;</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">}</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">will no longer cause the symbol <b>foo</b> to be global.&nbsp; If the function should be global, then change the forward-declaration to use <b>extern</b> rather than <b>static</b>.</font>

<p><br><br>

<p><font face="Times" size="+1"><b>Objective C in C Source Files Produces Error</b></font>

<p><font face="Times" size="+1">In the Release 3.0 compiler, detecting Objective C syntax in a C language source file is an error rather than a warning.&nbsp; Use the <b>-ObjC</b> flag to specify that the file should be compiled as an Objective C program.</font>

<p><br><br>

<p><font face="Times" size="+1"><b>Reversal of long long Word Ordering</b></font>

<p><font face="Times" size="+1">In the Release 2.0 compiler, the 64-bit integer type <b>long long</b> was implemented with little-endian word ordering.&nbsp; This was inconsistent with the 68k family's byte ordering, which is big-endian.&nbsp; For Release 3.0 the word ordering of the <b>long long</b> type has been reversed and is now big-endian.&nbsp; A new syntax for specifying long long constants has also been introduced.&nbsp; To specify a <b>long long</b> constant, use the suffix <b>LL</b> or <b>ULL</b>.&nbsp; For example:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">long long big_integer = -1LL;</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">unsigned long long big_unsigned = 0xffffffffffffffffULL;</font>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times" size="+1"><b>New Features</b></font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1"><b>New Optimization Levels</b></font>

<p><font face="Times" size="+1">The Release 3.0 compiler supports several new optimizations.&nbsp; Most of these new optimizations are not enabled by the <b>-O</b> switch, but only by the new <b>-O2</b> switch.&nbsp; Each optimization may be individually turned on or off by using the flag <b>-f</b><i>opt</i> or <b>-fno-</b><i>opt</i>.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3> <b>-fthread-jumps</b></font></td>

<td><font face="Times" size="+1">(enabled by <b>-O</b>)</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3> <b>-fcse-follow-jumps</b></font></td>

<td><font face="Times" size="+1">(enabled by <b>-O2</b>)</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3> <b>-fexpensive-optimizations</b></font></td>

<td><font face="Times" size="+1">(enabled by <b>-O2</b>)</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3> <b>-frerun-cse-after-loop</b></font></td>

<td><font face="Times" size="+1">(enabled by <b>-O2</b>)</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3> <b>-fstrength-reduce</b></font></td>

<td></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3> <b>-funroll-loops</b></font></td>

<td></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">The <b>-fstrength-reduce</b> optimization generally makes code worse on the 68k, so it is not enabled by default at any optimization level.&nbsp; The <b>-funroll-loops</b> switch is new, and may not be doing a great job yet.&nbsp; In any case, it makes huge space vs. speed tradeoffs, so you probably don't want to use it except under special circumstances.&nbsp; Compiling with <b>-O2 </b>may be significantly slower than compiling with <b>-O</b>, and may use much more memory. However, it consistently produces slightly better (often slightly smaller) code.</font>

<p><font face="Times" size="+1"><i>More optimizations have been added in 3.1.&nbsp; See new features above.</i></font>

<p><font face="Times" size="+1"><b>Objective C Protocols</b></font>

<p><font face="Times" size="+1">Protocols allow you to organize related method into groups that form high-level behaviors. This gives library builders a tool to identify sets of standard protocols, independent of the class hierarchy. Protocols provide language support for the reuse of design (interface), whereas classes support the reuse of code (implementation). Well designed protocols can help users of an application framework when learning or designing new classes.&nbsp; Here is a simple protocol definition for archiving objects:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">@protocol Archiving</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">- read:(NXTypedStream *)stream;</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">- write:(NXTypedStream *)stream;</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">@end</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">Once defined, protocols can be referenced in a class interface as follows.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">/*</font><br>
<img src="../../Images/sp.gif" width=115 height=1><font face="Courier">* MyClass inherits from Object and conforms to the</font><br>
<img src="../../Images/sp.gif" width=115 height=1><font face="Courier">* Archiving protocol.</font><br>
<img src="../../Images/sp.gif" width=115 height=1><font face="Courier">*/</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">@interface MyClass : Object &lt;Archiving&gt;</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">@end</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">Unlike copying methods to/from other class interfaces, any incompatible change made to the protocol will immediately be recognized by the compiler (the next time the class is compiled). Protocols also provide better type-checking without compromising the flexibility of untyped, dynamically bound objects.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">MyClass *obj1 = [MyClass new];</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">// legal, obj2 conforms to the Archiving protocol.</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">id &lt;Archiving&gt; obj2 = obj1;</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">// illegal, obj1 does not conform to the TargetAction protocol.</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">id &lt;TargetAction&gt; obj3 = obj1;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">Protocols can also be used to specify the interface to a remote object. Defining a protocol for a remote object is very similar to defining a protocol for a local object. There are, however, several method qualifiers that allow you to communicate additional information specific to providing a remote interface. For example, the <b>oneway</b> qualifier tells the compiler/runtime system not to block (that is, not to wait for the remote method to finish). In the local case, this qualifier is ignored; the method must finish before continuing execution). The complete list of qualifiers that were added for remote objects are:&nbsp; <b>in, out, inout, bycopy,</b> and <b>oneway</b>. Here are some example declarations:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">- in:(in int *)a out:(out int *)b inout:(inout int *)c;</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">- byCopy:(bycopy)a byProxy:theDefault;</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">- (oneway)asyncronousMessage;</font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">These new keywords may only be used in protocol declarations.&nbsp; They may not be used in other method declarations, or in method definitions.&nbsp; They may not be used at all for functions.</font>

<p><br><br>

<p><font face="Times" size="+1"><b>Forward Declaration of Classes</b></font>

<p><font face="Times" size="+1">In order to better support the use of protocols and static typing, Objective C now supports declarations of classes using the <b>@class</b> directive.&nbsp; For example, suppose you wish to create a class Foo which contains a statically typed instance variable of the class Bar. The header file <b>Foo.h</b> might look like this:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">#import &lt;objc/Object.h&gt;</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">@class Bar;</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">@interface Foo : Object</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">{</font><br>
<img src="../../Images/sp.gif" width=136 height=1><font face="Courier">Bar *myBar;</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">}</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">- (Bar *) myBar;</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">@end</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">Note how <b>Foo.h</b> declares the class Bar using the <b>@class</b> directive, rather than importing the header file <b>Bar.h</b>.&nbsp; This is because the the interface of Foo does not depend on any details of the interface of Bar (such as its instance variables or methods).&nbsp; It only depend on the fact that there is a class named Bar, which is what the <b>@class</b> directive specifies. Of course, the implementation of Foo may well depend on the interface of Bar, so <b>Foo.m </b>may well import <b>Bar.h</b>.</font>

<p><font face="Times" size="+1">The <b>@class</b> directive allows statically typed instance variables and method parameters of that class to be declared.&nbsp; It will not allow any operations which require the class's interface, such as sending messages to instances of the class, or referencing public instance variables.&nbsp; In these cases the compiler will issue an error indicating that the interface declaration for the class cannot be found.</font>

<p><font face="Times" size="+1">By using the <b>@class</b> directive in class interfaces rather than importing other classes' interfaces, many problems with circular definitions can be avoided.&nbsp; For example, if the class Bar contains a statically typed instance variable of the class Foo, and both header files import the other, then neither will compile successfully.&nbsp; However, if both header files are written using <b>@class</b> as shown above, no problems will occur.</font>

<p><font face="Times" size="+1">Several classes can be declared using a single <b>@class</b> directive by separating the class names with commas:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">@class Foo, Bar;</font>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1"><b>New Instance Variable Access Control</b></font>

<p><font face="Times" size="+1">The Objective C compiler now supports the access control specifiers <b>@private</b> and <b>@protected</b> in addition to <b>@public</b>.&nbsp; Instance variables which are declared <b>@public</b> are accessible by all;&nbsp; those which are declared <b>@protected</b> are accessible only by the defining class and its subclasses;&nbsp; and those which are declared <b>@private</b> are accessible only by the class in which they are contained.&nbsp; If no access control specifier is used the default is <b>@protected</b>, for backward compatibility.</font>

<p><br><br><br><br>

<p><font face="Times" size="+1"><b>Support for New Header File Organization</b></font>

<p><font face="Times" size="+1">As part of the reorganization of system header files, the default search path for included files has been changed.&nbsp; The new search path is:</font>

<p><img src="../../Images/sp.gif" width=6 height=1><font face="Times" size="+1">/NextDeveloper/Headers</font><br>
<img src="../../Images/sp.gif" width=6 height=1><font face="Times" size="+1">/NextDeveloper/Headers/ansi</font><br>
<img src="../../Images/sp.gif" width=6 height=1><font face="Times" size="+1">/NextDeveloper/Headers/bsd</font><br>
<img src="../../Images/sp.gif" width=6 height=1><font face="Times" size="+1">/LocalDeveloper/Headers</font><br>
<img src="../../Images/sp.gif" width=6 height=1><font face="Times" size="+1">/NextDeveloper/2.0CompatImports</font><br>
<img src="../../Images/sp.gif" width=6 height=1><font face="Times" size="+1">/usr/include</font><br>
<img src="../../Images/sp.gif" width=6 height=1><font face="Times" size="+1">/usr/local/include</font>

<p><font face="Times" size="+1">A symbolic link from <b>/usr/include</b> to <b>/NextDeveloper/Headers</b> should minimize compatibility problems.</font>

<p><br><br>

<p><font face="Times" size="+1"><b>New Preprocessor Directive</b></font>

<p><font face="Times" size="+1">To complement the ANSI <b>#error</b> preprocessor directive, the GNU compiler now supports a <b>#warning</b> directive.&nbsp; This directive prints a warning message containing the rest of the line, and continues compilation.&nbsp; This directive is useful for warning about use of obsolete header files, for example.</font>

<p><br><br>

<p><font face="Times" size="+1"><b>Attributes</b></font>

<p><font face="Times" size="+1">The keyword <b>__attribute__</b> allows you to specify special attributes of variables or structure fields.&nbsp; The attributes currently defined are the <b>aligned</b> and <b>format</b> attributes.</font>

<p><font face="Times" size="+1">The <b>aligned</b> attribute specifies the alignment of the variable or structure field.&nbsp; For example, the declaration:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">int x __attribute__ ((aligned (16))) = 0;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">causes the compiler to allocate the global variable <b>x</b> on a 16-byte boundary.&nbsp; On a 68000, this could be used in conjunction with an <b>asm</b> expression to access the <b>move16 </b>instruction which requires 16-byte aligned operands.</font>

<p><img src="../../Images/sp.gif" width=3 height=1><font face="Times" size="+1">You can also specify the alignment of structure fields.&nbsp; For example, to create a double-word aligned <b>int</b> pair, you could write:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">struct foo { int x[2] __attribute__ ((aligned (8))); };</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">This is an alternative to creating a union with a <b>aligned</b> member that forces the union to be double-word aligned.</font>

<p><font face="Times" size="+1">It is not possible to specify the alignment of functions; the alignment of functions is determined by the machine's requirements and cannot be changed.</font>

<p><font face="Times" size="+1">The <b>format</b> attribute specifies that a function takes <b>printf</b> or <b>scanf</b> style arguments which should be type-checked against a format string.&nbsp; For example, the declaration:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">extern int</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">my_printf (void *my_object, const char *my_format, ...)</font><br>
<img src="../../Images/sp.gif" width=136 height=1><font face="Courier">__attribute__ ((format (printf, 2, 3)));</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">causes the compiler to check the arguments in calls to <b>my_printf</b> for consistency with the <b>printf</b> style format string argument <b>my_format</b>.</font>

<p><font face="Times" size="+1">The first parameter of the <b>format</b> attribute determines how the format string is interpreted, and should be either <b>printf</b> or <b>scanf</b>.&nbsp; The second parameter specifies the number of the format string argument (starting from 1).&nbsp; The third parameter specifies the number of the first argument which should be checked against the format string.&nbsp; For functions where the arguments are not available to be checked (such as <b>vprintf</b>), specify the third parameter as zero.&nbsp; In this case the compiler only checks the format string for consistency.</font>

<p><font face="Times" size="+1">In the example above, the format string (<b>my_format</b>) is the second argument to <b>my_print </b>and the arguments to check start with the third argument, so the correct parameters for the format attribute are 2 and 3.</font>

<p><font face="Times" size="+1">The <b>format</b> attribute allows you to identify your own functions&nbsp; which take format strings as arguments, so that GNU CC can check the calls to these functions for errors.&nbsp; The compiler always checks formats for the ANSI library functions <b>printf</b>, <b>fprintf</b>, <b>sprintf</b>, <b>scanf</b>, <b>fscanf</b>, <b>sscanf</b>, <b>vprintf</b>, <b>vfprintf</b> and <b>vsprintf</b> whenever such warnings are requested (using <b>-Wformat</b>), so there is no need to modify the header file <b>stdio.h</b>.</font>

<p><br><br>

<p><font face="Times" size="+1"><b>New Compiler Warnings</b></font>

<p><font face="Times" size="+1">Version 2 of the GNU compiler has quite a few new warnings which you will no doubt encounter soon.&nbsp; Here is a summary of them with examples taken from <b>libsys</b> and <b>libNeXT</b>.&nbsp; Most of these warnings are enabled by the <b>-Wall</b> compiler switch.</font>

<p><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3>&nbsp; Warnings about argument mismatch now print the argument number:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">getpass.c:43: warning: incompatible pointer type for argument 2 of `signal'</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3>&nbsp; Warnings are generated for incorrect parameters to printf-style functions when the control argument is a string constant.&nbsp; These warnings are enabled by the <b>-Wformat </b>compiler switch, which is automatically enabled by the <b>-Wall</b> switch.&nbsp; These warnings can be turned off by using the <b>-Wnoformat</b> switch after the <b>-Wall</b> switch.</font>

<p><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3>&nbsp; Warnings are generated for empty bodies in if and else statements:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">View.m:2000: warning: empty body in an if-statement</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">if ([view getVisibleRect:&amp;visRect]);</font><br>
<img src="../../Images/sp.gif" width=136 height=1><font face="Courier">[view _display:&amp;visRect :1];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3>&nbsp; There are new warnings about potential operator precedence errors:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">Application.m:2015: warning: suggest parentheses around + or - inside shift</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">int curBPS = (NXNumberOfColorComponents (</font><br>
<img src="../../Images/sp.gif" width=136 height=1><font face="Courier">NXColorSpaceFromDepth(screens[cnt].depth)) &gt; 1) &lt;&lt; 8 +</font><br>
<img src="../../Images/sp.gif" width=136 height=1><font face="Courier">NXBPSFromDepth(screens[cnt].depth);</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">editsound.c:252: warning: suggest parentheses around + or - in operand of &amp;</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">s1-&gt;dataLocation = (strlen(s1-&gt;info)+3 &amp; ~3) - 4 +</font><br>
<img src="../../Images/sp.gif" width=136 height=1><font face="Courier">sizeof(SNDSoundStruct);</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">These warnings may seem fascist, but of the three occurrences of this warning in the</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap></td>

<td><font face="Times" size="+1">Application Kit, for example, it turned up these two bugs:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">ButtonCell.m:1414: warning: suggest parentheses around &amp;&amp; within ||</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">if (NXDrawingStatus == NX_DRAWING &amp;&amp;</font><br>
<img src="../../Images/sp.gif" width=136 height=1><font face="Courier">(LIGHTBYGRAY &amp;&amp; !CHANGEGRAY) || (CHANGEGRAY &amp;&amp; !LIGHTBYGRAY))</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">{</font><br>
<img src="../../Images/sp.gif" width=136 height=1><font face="Courier">NXHighlightRect(userRect);</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">}</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">appServicesMenu.m:245: warning: suggest parentheses around &amp;&amp; within ||</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">while (*s2)</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">{</font><br>
<img src="../../Images/sp.gif" width=136 height=1><font face="Courier">if (*s2 != '\t' &amp;&amp; *s2 != ' ' || *s2 != '\n')</font><br>
<img src="../../Images/sp.gif" width=164 height=1><font face="Courier">*s++ = *s2;</font><br>
<img src="../../Images/sp.gif" width=136 height=1><font face="Courier">s2++;</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">}</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3>&nbsp; This can catch subtle bugs, but forces you to be careful with unsigned:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">Listener.m:1306: warning: ordered comparison between signed and unsigned</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">int hsize = msg-&gt;header.msg_size;</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">if (msg-&gt;header.msg_type != MSG_TYPE_NORMAL || hsize &gt;</font><br>
<img src="../../Images/sp.gif" width=136 height=1><font face="Courier">sizeof(NXMessage))</font><br>
<img src="../../Images/sp.gif" width=136 height=1><font face="Courier">return NO;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3>&nbsp; This is a potentially useful warning, but it has the following problem:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">Application.m:2048: warning: cast from pointer to integer of different size</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">if ((BOOL)[theWindow perform:aSelector])</font><br>
<img src="../../Images/sp.gif" width=136 height=1><font face="Courier">return theWindow;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">You can work around this problem by casting to</font> <font face="Courier">int</font> <font face="Times" size="+1">and then to</font> <font face="Courier">BOOL</font><font face="Times" size="+1">.</font>

<p><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3>&nbsp; I have only seen this warning for code generated by Mig:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">lookupUser.c:135: warning: value computed is not used</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3>&nbsp; I haven't seen either of these, but they seem good:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">warning: unreachable code at beginning of switch statement</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">warning: shift count is negative</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3>&nbsp; This is legal, but rather confusing:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">symbols.c:62: warning: `sect_object_symbols' initialized and declared `extern'</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">extern struct sect_object_symbols sect_object_symbols = { 0 };</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3>&nbsp; Forward declare static functions using &quot;static&quot; rather than &quot;extern&quot;:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=90 height=1><font face="Courier">typedstream.m:148: warning: static function declaration for `_NXOpenEncodingStream' follows non-static</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">extern _CodingStream *_NXOpenEncodingStream (NXStream *physical);</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">static _CodingStream *_NXOpenEncodingStream (NXStream *physical) {</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3>&nbsp; Don't do this, it probably won't do what you want:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">cabs.c:35: warning: structure defined inside parms</font>

<p><img src="../../Images/sp.gif" width=108 height=1><font face="Courier">double cabs(struct {double x,y;} z)</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">{</font><br>
<img src="../../Images/sp.gif" width=136 height=1><font face="Courier">return(hypot(z.x,z.y));</font><br>
<img src="../../Images/sp.gif" width=108 height=1><font face="Courier">}</font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1"><b>New Predefined Macros</b></font>

<p><font face="Times" size="+1">The Release 3.0 compiler predefines new macros to aid in writing architecture-independent code.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">Architecture:&nbsp; In addition to the existing predefines which identify specific target architectures (for example, <b>m68k</b>, <b>i386</b>), the compiler also predefines the macro </font><font face="Courier">__ARCHITECTURE__</font> <font face="Times" size="+1">to be a string constant identifying the target architecture (&quot;m68k&quot;, &quot;i386&quot;).&nbsp; This macro is used by system header files to include the architecture-specific files without having to enumerate all supported architectures.</font></td></tr>

<tr valign=top>

<td width=72 height=13></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times" size="+1"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times" size="+1">Byte ordering:&nbsp; The compiler predefines either</font> <font face="Courier">__BIG_ENDIAN__</font> <font face="Times" size="+1">or </font><font face="Courier">__LITTLE_ENDIAN__</font><font face="Times" size="+1">, as appropriate for the target architecture.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times" size="+1"><b>Implementation Changes</b></font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1"><b>Name Change of Compiler Proper</b></font>

<p><font face="Times" size="+1">The names of the actual Objective C and C++ compilers (as opposed to the compiler driver</font> <font face="Courier">cc</font><font face="Times" size="+1">) have been changed to conform to the GNU standards.&nbsp; The Objective C compiler is now named</font> <font face="Courier">cc1obj</font><font face="Times" size="+1">, and the C++ compiler is named</font> <font face="Courier">cc1plus</font><font face="Times" size="+1">.&nbsp; The compiler uses</font> <font face="Courier">cc1obj</font> <font face="Times" size="+1">when compiling C or Objective C programs, and uses</font> <font face="Courier">cc1plus</font> <font face="Times" size="+1">when compiling C++ or Objective C++ programs.&nbsp; The compiler never uses the old name</font> <font face="Courier">cc1</font><font face="Times" size="+1">.</font>

<p><br><br>

<p><font face="Times" size="+1"><b>Improved Code Generation for Floating-point Conversions</b></font>

<p><font face="Times" size="+1">The compiler no longer emits library calls for any standard C operations.&nbsp; Conversions from floating-point values to integral values no longer call the library functions <b>_fixdfsi()</b>, <b>_fixsfsi()</b>, <b>_fixunsdfsi()</b> or <b>_fixunssfsi()</b>.&nbsp; Instead, the compiler emits a sequence of inline instructions to perform the operation.&nbsp; Certain programs which make extensive use of floating-point conversions may notice a significant speed up.</font>

<p><br><br>

<p><font face="Times" size="+1"><b>Method Descriptors for Protocols</b></font>

<p><font face="Times" size="+1">Type descriptors for methods defined within a protocol definition have the following additions.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=144 height=1><font face="Courier"><u>method qualifier&nbsp; encoding</u></font><br>
<img src="../../Images/sp.gif" width=144 height=1><font face="Courier">in 'n'</font><br>
<img src="../../Images/sp.gif" width=144 height=1><font face="Courier">inout 'N'</font><br>
<img src="../../Images/sp.gif" width=144 height=1><font face="Courier">out 'o'</font><br>
<img src="../../Images/sp.gif" width=144 height=1><font face="Courier">bycopy 'O'</font><br>
<img src="../../Images/sp.gif" width=144 height=1><font face="Courier">oneway 'V'</font><br>
<img src="../../Images/sp.gif" width=144 height=1><font face="Courier">const 'r'</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">Method descriptors for protocols have basic support for C structures. The format for structures and pointers to structures are encoded in the method descriptor. The following appkit method:</font></td></tr>

</table> <font face="Courier">- beginPageSetupRect:(const NXRect *)aRect</font><br>
<img src="../../Images/sp.gif" width=100 height=1><font face="Courier">placement:(const NXPoint *)location;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">is encoded as the following (changes underlined):</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=72 height=1><font face="Courier">@16@8:12<u>r^{_NXRect={_NXPoint=ff}{_NXSize=ff}}</u>16<u>r^{_NXPoint=ff}</u>20</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">Only &quot;one level&quot; of the structure is encoded. For example, if the structure contains pointers to other structures, only the struct name is encoded, not the format. This style of composite object is fully supported by Objective C. For example,</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=72 height=1><font face="Courier">- streamType:(NXStream *)stream;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">is encoded as the following:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=72 height=1><font face="Courier">@16@8:12<u>^{_NXStream=I**iilii^{stream_functions}^v}</u>16</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">Notice how the format of &quot;stream_functions&quot; is not expanded.</font>

<p><br><br>

<p><font face="Times" size="+1"><b>Improved Objective C Type Checking</b></font>

<p><font face="Times" size="+1">Assignments between variables of type <b>id</b> and <b>Class</b> no longer generate spurious warnings, so the <b>Class</b> type can now be used more effectively.</font></td></tr>

</table>



<p>

</body>
</html>
